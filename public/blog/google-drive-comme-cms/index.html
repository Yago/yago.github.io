<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Google Drive comme CMS !</title>
    <meta name="description" content="">
    <meta name="keywords" content="HTML,CSS,XML,JavaScript">
    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="/css/vendors.min.css">
    <link rel="stylesheet" href="/css/types.css">
    <link rel="stylesheet" href="/css/main.css">

    <script src="https://use.typekit.net/cwx4xcg.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    
  <img src="/img/cover/google-drive comme cms !.jpg" class="cover">
  <div class="article-container">
    <div class="text-center">
      <h1>Google Drive comme CMS !</h1>
      <div class="date">
        11.03.2014 &bullet; Yann Gouffon
      </div>
    </div>

    <article>
      <p>N&apos;avez-vous jamais r&#xEA;v&#xE9; de mettre en place une petite administration pour votre site afin d&apos;y ajouter ou d&apos;y modifier du contenu sans douleur ? Maintenant, avec Google, c&apos;est possible !</p>
<p>Google, avec son Drive, propose en effet de cr&#xE9;er et de stocker dans le cloud des documents de plusieurs types diff&#xE9;rents; des documents textes, des tableurs, des pr&#xE9;sentations et m&#xEA;me des formulaires. Dans notre cas, nous allons utiliser les formulaires et les tableurs, ou &quot;spreadsheet&quot;.</p>
<p>##Le concept</p>
<p>Comme dans une administration classique, nous allons utiliser un formulaire, li&#xE9; &#xE0; une spreadsheet o&#xF9; nous irons rechercher les donn&#xE9;es pr&#xE9;c&#xE9;demment entr&#xE9;es. </p>
<blockquote>
<p>Quelle diff&#xE9;rence avec une base de donn&#xE9;e ?</p>
</blockquote>
<p>Aucune, le syst&#xE8;me est le m&#xEA;me, mais l&apos;avantage de ce syst&#xE8;me est sa rapidit&#xE9; de mise en place. On pourra donc l&apos;utiliser pour une quantit&#xE9; r&#xE9;duite de donn&#xE9;es et une structure &#xE0; une table.</p>
<p>Dans notre exemple, nous allons cr&#xE9;er une petite administration afin d&apos;ajouter et d&apos;afficher la liste des membres de notre association (fictive).</p>
<p>##Ajouter des membres</p>
<p>Pour cela, nous allons commencer par cr&#xE9;er un nouveau formulaire que nous nommerons &quot;Ajout de membres&quot; avec les champs nom, pr&#xE9;nom et E-mail. Ensuite, avec &quot;Choisir une destination pour la r&#xE9;ponse&quot;, nous allons lui assigner une nouvelle spreadsheet que nous nommerons &quot;Liste des membres&quot;.</p>
<p>Maintenant, vous pourriez tr&#xE8;s bien partager le <a href="https://docs.google.com/forms/d/1Le-duty7sC7hRU5vidzYpeMT_Ww7s5mU3c4k4VjXU8k/viewform">lien vers votre formulaire</a> ou simplement l&apos;int&#xE9;grer sur votre site au moyen de l&apos;iframe propos&#xE9;. Mais dans les deux cas, l&apos;aspect visuel resterra peu convaincant.</p>
<p>Pour int&#xE9;grer le formulaire directement sur notre site, il nous suffit de visiter le formulaire comme si nous souhaitions le remplir, puis, en affichant le code source de la page, copier simplement tout l&apos;&#xE9;l&#xE9;ment formulaire et le coller dans notre code.</p>
<p>Nous devrions donc avoir quelque chose comme &#xE7;a :</p>
<pre class="line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://docs.google.com/forms/d/1Le-duty7sC7hRU5vidzYpeMT_Ww7s5mU3c4k4VjXU8k/formResponse<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ss-form<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>_self<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onsubmit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Maintenant, vous constaterez surement qu&apos;apr&#xE8;s la soumission, nous nous retrouvons avec la m&#xEA;me page toute moche de confirmation.</p>
<p>Pour d&#xE9;finir une page de confirmation diff&#xE9;rente, il nous suffit de remplacer le :</p>
<pre class="line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://docs.google.com/forms/d/1Le-duty7sC7hRU5vidzYpeMT_Ww7s5mU3c4k4VjXU8k/formResponse<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ss-form<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>_self<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onsubmit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>par :</p>
<pre class="line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"><span class="token keyword">var</span> submitted<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden_iframe<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden_iframe<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>if(submitted) {window.location<span class="token punctuation">=</span><span class="token punctuation">&apos;</span>http://mon-site.com/ma-page-de-confirmation.html<span class="token punctuation">&apos;</span>;}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://docs.google.com/forms/d/1Le-duty7sC7hRU5vidzYpeMT_Ww7s5mU3c4k4VjXU8k/formResponse<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden_iframe<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onsubmit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submitted<span class="token punctuation">=</span>true;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Nous voici pr&#xE8;s &#xE0; rentrer nos membres ! Maintenant, si nous souhaitions &#xEA;tre les seuls &#xE0; pouvoir acc&#xE9;der &#xE0; ce formulaire comme dans une administration classique, rien ne nous emp&#xEA;che de le placer dans un r&#xE9;pertoire prot&#xE9;g&#xE9; par un .htpasswd.</p>
<p>##Afficher les membres</p>
<p>Avant toute chose, il nous faut nous rendre dans notre spreadsheet de r&#xE9;sultats et la rendre consultable avec le lien (option de partage). Puis, dans Fichier/Publier sur le Web, nous allons d&#xE9;marrer la publication. Ce sera cette publication, duplicata de notre spreadsheet, qui sera utilis&#xE9;e pour afficher les donn&#xE9;es. N&apos;oubliez pas de recopier la cl&#xE9; de votre document.</p>
<p>La suite est assez simple et m&#xEA;me les profanes &#xE0; PHP comprendront ! Nous allons simplement r&#xE9;cup&#xE9;rer le JSON sortant de la spreasheet et afficher les &#xE9;l&#xE9;ments ligne par ligne.</p>
<p>Pour r&#xE9;cup&#xE9;rer le JSON (en PHP) :</p>
<pre class="line-numbers"><code class="language-php"><span class="token comment" spellcheck="true">// Cl&#xE9; de la spreadsheet</span>
<span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">&apos;0AmViBjefqXQgdG43QVJpcUhDeXU1NGpWSS1DWW9RNkE&apos;</span><span class="token punctuation">;</span>

<span class="token variable">$spreadsheet</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span>&apos;https<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//spreadsheets.google.com/feeds/list/%s/1/public/values?alt=json&apos;, $key);</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$spreadsheet</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Maintenant, il ne reste plus qu&apos;&#xE0; faire une boucle sur chaque ligne et d&apos;en afficher le contenu. En l&apos;occurrence nous voulons afficher le pr&#xE9;nom et le nom de nos membres, ainsi qu&apos;un lien vers son adresse e-mail.</p>
<pre class="line-numbers"><code class="language-php"><span class="token comment" spellcheck="true">// Pour chaque ligne (entr&#xE9;e) du tableau :</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">&apos;feed&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;entry&apos;</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">echo</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">&apos;gsx$pr&#xE9;nom&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;$t&apos;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">&apos; &apos;</span><span class="token punctuation">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">&apos;gsx$nom&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;$t&apos;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>&apos;<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span></span>&apos;<span class="token punctuation">;</span>
  <span class="token keyword">echo</span> &apos;<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mailto:<span class="token punctuation">&apos;</span>.$row[<span class="token punctuation">&apos;</span>gsx$e-mail<span class="token punctuation">&apos;</span>][<span class="token punctuation">&apos;</span>$t<span class="token punctuation">&apos;</span>].<span class="token punctuation">&apos;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span><span class="token string">&apos;.$row[&apos;</span>gsx<span class="token variable">$e</span><span class="token operator">-</span>mail<span class="token string">&apos;][&apos;</span><span class="token variable">$t</span><span class="token string">&apos;].&apos;</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span></span>&apos;<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>##Conclusion</p>
<p>On peut bien &#xE9;videmment aller plus loin dans la complexit&#xE9;, jusqu&apos;&#xE0; cr&#xE9;er un petit moteur de blog sur ce principe. N&#xE9;anmoins, il reste plus ad&#xE9;quat d&apos;utiliser une &quot;vraie&quot; base de donn&#xE9;es dans le cas d&apos;un site plus complexe.</p>
<p>L&apos;avantage de ce syst&#xE8;me r&#xE9;side dans le fait que les donn&#xE9;es restent accessibles et &#xE9;ditables directement &#xE0; la source pour le client. Il pourra, en effet, y faire directement ses modifications, mais aussi changer le statut d&apos;une ligne en passant une valeur de TRUE &#xE0; FALSE par exemple ;)</p>
<p><a href="http://antistatique.net/blog/2014/03/11/google-drive-comme-cms/">Retrouver cet article sur le blog d&apos;Antistatique !</a></p>

    </article>
  </div>


    <script src="/js/vendors.min.js"></script>
  </body>
</html>
